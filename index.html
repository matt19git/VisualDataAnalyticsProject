<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .gridlines line {
      stroke: #bbb;
    }

    .gridlines .domain {
      stroke: none;
    }

    #graph1 {
      padding-left: 25px;
    }

    .median {
      stroke: black;
      stroke-width: 2px;
    }
    .whisker {
      stroke: black;
      stroke-width: 1.5px;
    }

    .title {
      font-size: 25px;
      font-weight: bold;
      fill: red;
    }
  </style>
</head>

<body>
  <p id="graph1">
      <svg id="graph2" width="800" height="500">
  <script>
    const svg2 = d3.select("svg#graph2");

    d3.csv("MoviesOnStreamingPlatforms.csv").then((data) => {
      data.forEach(d => {
        //allowing rotten tomatoes score to be int because we need to do math on the values
        d["Rotten Tomatoes"] = +d["Rotten Tomatoes"].split("/")[0]; 
      });
      const services = ["Netflix", "Disney+", "Hulu", "Prime Video"];
      const groupedData = services.map(service => {
        //getting specific streaming services, and getting a score value by adding the score 
        //to the service if the service column equals 1, because of the way the csv we got from is set up
        //it makes something like this necessary
        return {
          service: service,
          scores: data.filter(d => +d[service] === 1).map(d => d["Rotten Tomatoes"]) 
        };
      });
      //finding the stats values from the data we filtered
      const stats = groupedData.map(g => {
        const sortedScores = g.scores.sort(d3.ascending);
        const q1 = d3.quantile(sortedScores, 0.25);
        const median = d3.quantile(sortedScores, 0.5);
        const q3 = d3.quantile(sortedScores, 0.75);
        const min = d3.min(sortedScores);
        const max = d3.max(sortedScores);
        console.log(sortedScores)
        console.log(min)
        console.log(max)
        console.log(q1)
        console.log(q3)
        return {
          service: g.service,
          q1, median, q3, min, max
        };
      });
      const width = svg2.attr('width');
      const height = svg2.attr('height');
      const margin = { top: 20, right: 30, bottom: 50, left: 40 };
      const chartWidth = width - margin.left - margin.right;
      const chartHeight = height - margin.top - margin.bottom;
//colors for each streaming service, and choosing a color based on their logo/vibe
      const colorScale = d3.scaleOrdinal()
      .domain(services)
      .range(["#FF0000", "#e78ac3", "#008000", "#8da0cb"]);
//scaleBand is used for boxplot
      const xScale = d3.scaleBand()
        .domain(services)
        .range([0, chartWidth])
        .padding(0.4);

      const yScale = d3.scaleLinear()
        .domain([0, 100]) 
        .range([chartHeight, 0]);

      const chartArea = svg2.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);


        
      chartArea.append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(0, ${chartHeight})`)
        .call(d3.axisBottom(xScale));

      chartArea.append("g")
        .attr("class", "y axis")
        .call(d3.axisLeft(yScale));

      stats.forEach((d, i) => {
        const center = xScale(d.service) + xScale.bandwidth() / 2;

        chartArea.append("rect")
          .attr("class", "box")
          .attr("x", center - 20)
          .attr("width", 40)
          .attr("y", yScale(d.q3))
          .attr("height", yScale(d.q1) - yScale(d.q3))
          .attr("fill", colorScale(d.service));

        chartArea.append("line")
          .attr("class", "median")
          .attr("x1", center - 20)
          .attr("x2", center + 20)
          .attr("y1", yScale(d.median))
          .attr("y2", yScale(d.median));

          chartArea.append("line")
          .attr("class", "whisker")
          .attr("x1", center)
          .attr("x2", center)
          .attr("y1", yScale(d.min))
          .attr("y2", yScale(d.q1))
          .attr("fill", colorScale(d.service));

        chartArea.append("line")
          .attr("class", "whisker")
          .attr("x1", center)
          .attr("x2", center)
          .attr("y1", yScale(d.q3))
          .attr("y2", yScale(d.max))
          .attr("fill", colorScale(d.service));

        chartArea.append("line")
          .attr("class", "whisker")
          .attr("x1", center - 10)
          .attr("x2", center + 10)
          .attr("y1", yScale(d.min))
          .attr("y2", yScale(d.min));

        chartArea.append("line")
          .attr("class", "whisker") 
          .attr("x1", center - 10)
          .attr("x2", center + 10)
          .attr("y1", yScale(d.max))
          .attr("y2", yScale(d.max));
      });
      svg2.append("text")
      .attr("class", "title")
      .attr("text-anchor", "middle")
      .attr("x", width / 2)
      .attr("y", margin.top)
      .text("Rotten Tomatoes Scores for Streaming Services");
      svg2.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "end")
        .attr("x", width / 2 + 40)
        .attr("y", height - 10)
        .text("Streaming Services");

      svg2.append("text")
        .attr("class", "y label")
        .attr("text-anchor", "middle")
        .attr("x", -height/2+30)
        .attr("y", 15)
        .attr("transform", "rotate(-90)")
        .text("Rotten Tomatoes Score");


        
      });
    </script>
    </svg>
    </p>

  <p id="graph2">
    <svg id="barchart" height="500" width="800" style="margin-top:50px"></svg>
    <script>
      d3.csv("streaming_service.csv").then(data => {
        data = data.filter(d =>
          d.date.includes("Jan-2024") && ["Netflix", "Disney+", "Hulu", "Prime Video"].includes(d.service)
        );

        const colorMap = {
          "Netflix": "#FF0000",
          "Hulu": "#008000",
          "Prime Video": "#8da0cb",
          "Disney+": "#e78ac3",
        };
        data.forEach(d => d.color = colorMap[d.service]);

        const svg = d3.select("svg#barchart");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = { top: 30, right: 10, bottom: 70, left: 70 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        let chartArea = svg.append("g").attr("id", "points")
          .attr("transform", `translate(${margin.left},${margin.top})`);
        let annotations = svg.append("g").attr("id", "annotations");

        const priceExtent = d3.extent(data, d => +d.price);
        const priceScale = d3.scaleLinear().domain([10, 19]).range([chartHeight, 0]);

        
        let leftAxis = d3.axisLeft(priceScale); 

        let leftGridlines = d3.axisLeft(priceScale)
          .tickSize(-chartWidth - 10)
          .tickFormat("");

        annotations.append("g")
          .attr("class", "y axis")
          .attr("transform", `translate(${margin.left - 10},${margin.top})`)
          .call(leftAxis);

        annotations.append("g")
          .attr("class", "y gridlines")
          .attr("transform", `translate(${margin.left - 10},${margin.top})`)
          .call(leftGridlines);

        svg.append("text")
          .attr("text-anchor", "middle")
          .attr("transform", `translate(${margin.left / 3},${height / 2})rotate(-90)`)
          .text("Price per month (dollars)");

          

        const services = d3.map(data, d => d.service);
        const serviceScale = d3.scaleBand().domain(services).range([0, chartWidth])
          .padding(0.05);
        let bottomAxis = d3.axisBottom(serviceScale);

        annotations.append("g")
          .attr("class", "x axis")
          .attr("transform", `translate(${margin.left},${chartHeight + margin.top})`)
          .call(bottomAxis);

        svg.append("text")
          .attr("text-anchor", "middle")
          .attr("x", margin.left + chartWidth / 2)
          .attr("y", height - 20)
          .text("Streaming Service");

          

        chartArea.selectAll('rect.bar').data(data)
          .join('rect').attr('class', 'bar')
          .attr("fill", d => d.color)
          .attr("x", d => serviceScale(d.service))
          .attr("y", d => priceScale(+d.price))
          .attr("height", d => chartHeight - priceScale(+ d.price))
          .attr("width", serviceScale.bandwidth());

          svg.append("text")
          .attr("class", "title")
          .attr("text-anchor", "middle")
          .attr("x", width / 2)
          .attr("y", margin.top-10)
          .text("Price Per Month for Streaming Services");


      });
    </script>
  </p>


</body>


</html>
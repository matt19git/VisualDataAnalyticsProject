<html>

<body>

  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  
    <style>
    
    .gridlines line {
      stroke: #bbb;
    }
    
    .gridlines .domain {
      stroke: none;
    }
  
    </style>

    <p id="graph1">
      <svg id="graph1" height="500" width="500">


        <script>
          const svg = d3.select("svg#graph1");

          <!-- d3.csv("movies_dataset.csv", d3.autoType)
          .then( (data) => { -->
          //Have to do some stuff to convert the download and runtime from the dataset
          //into numbers from strings, because d3.autoType above for some reason could
          //not handle the commas
          d3.csv("movies_dataset.csv")
            .then((data) => {
            piracy_dataset = data.forEach(d => {
            if (typeof d.downloads === 'string') {
        d.downloads = parseInt(d.downloads.replace(/,/g, ''), 10);
      }
      if (typeof d.run_time === 'string') {
        d.run_time = parseInt(d.run_time.replace(/,/g, ''), 10);
      }
    });
            d3.csv("netflix_titles.csv", d3.autoType)
          .then( (data2) => {
            
        // 1. Check data quality
            
            piracy_dataset = data.filter(d => d.run_time > 0 && d.downloads > 0); //piracy movies that have at least 1 download
            netflix_dataset = data2.filter(d => d.type === 'Movie'); //netflix dataset showing only movies
            console.log(piracy_dataset)
            console.log(netflix_dataset)
            netflixDirectors = new Set(netflix_dataset.map(d => d.director));
            sharedDirectorDataset = piracy_dataset.filter(d => netflixDirectors.has(d.director)); //piracy dataset, but only with directors who were on netflix dataset
            console.log(sharedDirectorDataset)


            const width = svg.attr('width');
            const height = svg.attr('height');
            const margins = { top: 20, right: 20, bottom: 50, left: 60 }; // You can also include quotes
            const chartWidth = width - margins.left - margins.right;
            const chartHeight = height - margins.top - margins.bottom;
            let chartArea = svg.append('g')
              .attr('transform', `translate(${margins.left},${margins.top})`);
            const movielengthextent = d3.extent(piracy_dataset, d => d['run_time']);
            
            const downloadsextent = d3.extent(piracy_dataset, d => d['downloads']);
          
            let xscale = d3.scaleLinear()
              .domain(movielengthextent) // From our data
              .range([0, chartWidth]);
            let yscale = d3.scaleLinear()
              .domain(downloadsextent) // From our data
              .range([chartHeight, 0]);
              piracy_dataset.forEach((d, i) => {
                chartArea.append('circle')
                  .attr('r', 3)
                  .attr('cx', xscale(d['run_time']))
                  .attr('cy', yscale(d['downloads']))
                  .attr('opacity', .3)
                  .style('fill', 'darkblue');
                  console.log(i)
  
  
              });
            let leftAxis = d3.axisLeft(yscale);
            svg.append("g")
              .attr("class", "y axis")
              .attr("transform", `translate(${margins.left-10}, ${margins.top})`)
              .call(leftAxis);

            let bottomAxis = d3.axisBottom(xscale).ticks(9);
            svg.append("g")
              .attr("class", "x axis")
              .attr("transform", `translate(${margins.left}, ${chartHeight+ margins.top+10})`)
              .call(bottomAxis);


            let leftGridlines = d3.axisLeft(yscale).tickFormat("").tickSize(-chartWidth - 10);
            svg.append("g")
              .attr("class", "y gridlines")
              .attr("transform", `translate(${margins.left-10}, ${margins.top})`)
              .call(leftGridlines);

            let bottomGridlines = d3.axisBottom(xscale).tickFormat("").tickSize(-chartHeight - 10);
            svg.append("g")
              .attr("class", "x gridlines")
              .attr("transform", `translate(${margins.left}, ${chartHeight+ margins.top+10})`)
              .call(bottomGridlines);
            
              chartArea.raise()
              console.log(movielengthextent)
              console.log(downloadsextent)

          















          })





        });
        </script>
      </svg>
    </p>
  </head>
</body>


</html>